---
import AppLayout from "@layouts/AppLayout.astro";
import { Picture } from "@astrojs/image/components";
import authorImage from "@images/me.jpeg";
import "../styles/syntaxHighlight.css";
import BlogImage from "@components/BlogImage.astro";
import { author, twitter } from "@content/socials";

let { title, description, heroImage, imageAlt, pubDate } = Astro.props.content;

const fullDate = new Date(pubDate).toLocaleDateString("en", {
  dateStyle: "full",
});

[pubDate] = pubDate.split("T");
const ogImageParams = new URLSearchParams({
  title,
  pubDate,
}).toString();

let posts = await Astro.glob("../pages/blog/*.mdx");
posts = posts.sort(
  (a, b) =>
    new Date(b.frontmatter.pubDate).valueOf() -
    new Date(a.frontmatter.pubDate).valueOf()
);
// get the index of the current post
const index = posts.findIndex((post) => {
  return Astro.request.url.includes(post.url);
});
// get the next and previous posts
const nextPost = posts[index + 1];
const prevPost = posts[index - 1];
---

<AppLayout
  title={title}
  description={description}
  heroImage={`/og?${ogImageParams}`}
  pubDate={pubDate}
  imageAlt={imageAlt}
>
  <header class="flex flex-col justify-center items-center mb-8">
    <time
      datetime={pubDate}
      class="block text-center text-zinc-400 mb-3 text-sm sm:text-base"
    >
      {fullDate}
    </time>
    <h1
      class="text-2xl sm:text-4xl sm:leading-tight font-sans mb-6 font-semibold text-center text-transparent bg-clip-text bg-gradient-to-r from-green-400 via-blue-500 to-purple-500"
    >
      {title}
    </h1>
    <div class="inline-flex gap-2 justify-center items-center mb-6">
      <div class="aspect-square rounded-full overflow-hidden">
        <Picture
          src={authorImage}
          alt="Image of the author"
          aspectRatio="1:1"
          widths={[40, 80, 120]}
          loading="eager"
          sizes="40px"
          width={40}
          height={40}
        />
      </div>
      <p class="text-zinc-400 text-sm">
        <span class="block font-semibold">{author}</span>
        <a
          class="text-blue-400 focus:outline-none focus:underline hover:underline focus:font-medium hover:font-medium block"
          href="https://twitter.com/kevinzunigacuel"
          target="_blank"
          rel="noopener noreferrer"
          >{twitter}
        </a>
      </p>
    </div>
    <BlogImage
      src={`/static/${heroImage}`}
      alt={imageAlt}
      loading="eager"
      aspectRatio={1.91}
    />
  </header>
  <article
    class="prose prose-invert prose-code:text-zinc-300 prose-a:text-blue-400 max-w-none hover:prose-a:underline focus:prose-a:underline prose-a:no-underline prose-headings:text-teal-500 prose-img:rounded-md"
  >
    <slot />
  </article>
    <aside class="flex flex-col sm:flex-row mt-10 gap-4 sm:gap-6 w-full">
      {
        prevPost && (
          <a
            href={prevPost.url + "/"}
            class="group flex flex-col grow text-sm p-4 rounded-md bg-zinc-800 border border-opacity-0 border-teal-400 hover:border-opacity-100 transition-all hover:bg-teal-600/20"
          >
            <p class="text-zinc-400 mb-1">&larr; Previous post</p>
            <p class="font-semibold text-zinc-300 group-hover:text-teal-400">
              {prevPost.frontmatter.title}
            </p>
          </a>
        )
      }
      {
        nextPost && (
          <a
            href={nextPost.url + "/"}
            class="group flex flex-col grow text-right text-sm p-4 rounded-md bg-zinc-800 border border-opacity-0 border-teal-400 hover:border-opacity-100 transition-all hover:bg-teal-600/20"
          >
            <p class="text-zinc-400 mb-1">Next post &rarr;</p>
            <p class="font-semibold text-zinc-300 group-hover:text-teal-400">
              {nextPost.frontmatter.title}
            </p>
          </a>
        )
      }
    </aside>
</AppLayout>
